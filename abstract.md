# Domain-Driven Design (DDD) - Практическое руководство

## Оглавление
1. [Основные концепции](#основные-концепции)
2. [Пошаговое руководство по идентификации объектов](#пошаговое-руководство-по-идентификации-объектов)
3. [Практические примеры](#практические-примеры)
4. [Архитектурные слои и шаблоны](#архитектурные-слои-и-шаблоны)
5. [Принципы проектирования](#принципы-проектирования)

## Основные концепции

### Сущность (Entity)
- **Определение**: Объект с уникальной идентичностью, сохраняющейся на протяжении всего жизненного цикла
- **Ключевые характеристики**:
  * Имеет уникальный идентификатор
  * Может изменяться со временем
  * Отслеживается через разные состояния
  * Два объекта с одинаковыми атрибутами различны, если имеют разные идентификаторы

### Объект-значение (Value Object)
- **Определение**: Объект без уникальной идентичности, определяемый только своими атрибутами
- **Ключевые характеристики**:
  * Неизменяемый после создания
  * Заменяемый
  * Не имеет уникального идентификатора
  * Сравнивается по значениям атрибутов

### Агрегат (Aggregate)
- **Определение**: Кластер связанных объектов, рассматриваемых как единое целое
- **Ключевые характеристики**:
  * Имеет корень (всегда сущность)
  * Обеспечивает транзакционную целостность
  * Защищает бизнес-инварианты
  * Все изменения происходят через корень

## Пошаговое руководство по идентификации объектов

### Шаг 1: Определение объектов-значений
1. **Контрольные вопросы**:
   - Важны ли только атрибуты объекта?
   - Можно ли заменить объект другим с теми же значениями?
   - Должен ли объект быть неизменяемым?

2. **Критерии принятия решения**:
   - Объект определяется только атрибутами ✓
   - Не требует уникальной идентификации ✓
   - Может быть заменён аналогичным ✓
   - Не имеет собственного жизненного цикла ✓

### Шаг 2: Определение сущностей
1. **Контрольные вопросы**:
   - Нужно ли отслеживать объект во времени?
   - Важна ли его уникальная идентичность?
   - Меняется ли объект, сохраняя идентичность?

2. **Критерии принятия решения**:
   - Требуется уникальная идентификация ✓
   - Имеет собственный жизненный цикл ✓
   - Может изменять атрибуты ✓
   - Отслеживается во времени ✓

### Шаг 3: Определение агрегатов
1. **Контрольные вопросы**:
   - Какие объекты должны изменяться вместе?
   - Какие объекты зависят друг от друга?
   - Какие бизнес-правила нужно защищать?

2. **Критерии принятия решения**:
   - Есть главная сущность (корень) ✓
   - Есть зависимые объекты ✓
   - Есть бизнес-правила для группы объектов ✓
   - Требуется транзакционная целостность ✓

### Шаг 4: Определение связей
1. **Между агрегатами**:
   - Только по идентификатору
   - Слабая связь
   - Независимое изменение

2. **Внутри агрегата**:
   - Сильная связь
   - Каскадные изменения
   - Согласованное состояние

## Практические примеры

### Пример 1: Order (Заказ)
```
Агрегат Order
│
├── Order (сущность, корень)
│   ├── ID заказа
│   ├── Статус
│   └── Дата создания
│
├── OrderItems (коллекция объектов-значений)
│   ├── OrderItem 1
│   ├── OrderItem 2
│   └── OrderItem N
│
└── Address (объект-значение)
```

**Почему такая структура**:
1. Order - сущность и корень агрегата:
   - Имеет уникальный ID
   - Отслеживается во времени
   - Управляет жизненным циклом заказа

2. OrderItem - объект-значение:
   - Определяется атрибутами
   - Не имеет собственной идентичности
   - Существует только в контексте заказа

3. Address - объект-значение:
   - Определяется атрибутами
   - Может быть заменён
   - Неизменяемый

### Пример 2: Product (Товар)
```
Агрегат Product
│
├── Product (сущность, корень)
│   ├── SKU (артикул)
│   ├── Название
│   └── Статус
│
├── Price (объект-значение)
│   ├── Сумма
│   └── Валюта
│
└── Specifications (объект-значение)
    ├── Характеристика 1
    ├── Характеристика 2
    └── Характеристика N
```

**Почему такая структура**:
1. Product - сущность и корень:
   - Имеет уникальный артикул
   - Отслеживается во времени
   - Управляет своими характеристиками

2. Price - объект-значение:
   - Определяется суммой и валютой
   - Неизменяемый
   - Может быть заменён

3. Specifications - объект-значение:
   - Набор характеристик
   - Определяется значениями
   - Заменяется целиком

## Архитектурные слои и шаблоны

### Слои архитектуры
1. **Слой предметной области (Domain Layer)**
   - Бизнес-логика
   - Модели предметной области
   - Независим от других слоев

2. **Слой приложения (Application Layer)**
   - Координация задач
   - Без бизнес-логики
   - Использует domain layer

3. **Слой инфраструктуры (Infrastructure Layer)**
   - Технические детали
   - Реализация интерфейсов
   - Работа с внешними системами

4. **Слой интерфейса (Interface Layer)**
   - UI/API
   - Форматирование данных
   - Обработка запросов

### Тактические шаблоны
1. **Репозиторий (Repository)**
   - Абстракция хранилища
   - Работа с коллекциями объектов
   - Инкапсуляция запросов

2. **Фабрика (Factory)**
   - Создание сложных объектов
   - Инкапсуляция создания
   - Обеспечение инвариантов

3. **Доменный сервис (Domain Service)**
   - Операции над несколькими агрегатами
   - Сложная бизнес-логика
   - Процессы предметной области

4. **Событие предметной области (Domain Event)**
   - Запись о значимом событии
   - Асинхронная коммуникация
   - Отслеживание изменений

## Принципы проектирования

### Основные принципы
1. **Инкапсуляция**
   - Скрытие деталей реализации
   - Защита инвариантов
   - Контроль изменений

2. **Слабая связанность**
   - Минимум зависимостей
   - Независимое изменение
   - Ссылки по ID

3. **Высокая связность**
   - Логически связанные компоненты вместе
   - Четкие границы
   - Ясная ответственность

### Практические рекомендации
1. **Проектирование агрегатов**
   - Стремитесь к маленьким агрегатам
   - Определяйте четкие границы
   - Защищайте инварианты

2. **Работа с объектами-значениями**
   - Делайте неизменяемыми
   - Используйте для описания характеристик
   - Заменяйте целиком

3. **Управление сущностями**
   - Контролируйте жизненный цикл
   - Обеспечивайте уникальность
   - Отслеживайте изменения
